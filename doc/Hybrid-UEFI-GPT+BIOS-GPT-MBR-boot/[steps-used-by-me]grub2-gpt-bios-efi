1-

首先用 ddrescue 、dd ， partclone.dd
 等工具将该盘分区表清空。

比如：

下面的这个可以保证足够吧 前两个分区清零：

$ sudo dd if=/dev/zero of=/dev/sdc bs=1M count=1000


然后，使用 gparted，gdisk等工具，建立如下的分区结构：


werner@debian-01:~$ sudo gdisk -l /dev/sdc
GPT fdisk (gdisk) version 1.0.3

Partition table scan:
  MBR: protective
  BSD: not present
  APM: not present
  GPT: present

Found valid GPT with protective MBR; using GPT.
Disk /dev/sdc: 60063744 sectors, 28.6 GiB
Model: Ultra USB 3.0   
Sector size (logical/physical): 512/512 bytes
Disk identifier (GUID): F665095B-CB40-476B-876B-27C48DAC61F1
Partition table holds up to 128 entries
Main partition table begins at sector 2 and ends at sector 33
First usable sector is 34, last usable sector is 60063710
Partitions will be aligned on 2048-sector boundaries
Total free space is 39374781 sectors (18.8 GiB)

Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048            6143   2.0 MiB     EF02  
   2            6144          210943   100.0 MiB   EF00  
   3          210944        20690943   9.8 GiB     8300 


2- 安装方法：


grub-install ... -v  观察其调用细节，发现是基于  grub-mkimage / efibootmgr工作的。





基于 grub-mkimage 的方法:

ref：
https://www.ibm.com/developerworks/community/blogs/5144904d-5d75-45ed-9d2b-cf1754ee936a/entry/uefi-grub2?lang=en

 需要注意如下几点：

1) 模块是按照一定顺序排列的。如果打破默认序列，EFI文件不可用。

2) fat必须被添加到EFI文件中，用以从FAT文件系统中寻找后续启动文件。

3) grub2-mkstandalone是grub2-mkimage功能的延伸，可以增加任何文件，甚至文件夹到EFI文件中，具体细节可参考grub2-mkstandalone -h。

https://stackoverflow.com/questions/35269943/how-does-the-grub2-uefi-loader-know-where-to-look-for-the-configuration-file-or

首先准备如下文件：
grub-config.cfg 

#/dev/sda2                          vfat                       /mnt/sda2                              EF4B-3153
search.fs_uuid EF4B-3153 root
# 根据情况修改：
set prefix=($root)'/EFI/uefi-hd'
configfile $prefix/grub.cfg

sudo grub-mkimage -c grub-config.cfg -o grubx64.efi -O x86_64-efi -p ''  $( ls -1 /usr/lib/grub/x86_64-efi/*mod | sed 's/\.mod//;s/.*\///' | xargs )



基于 grub-mkstandalone 的独立的 GRUB (可移植的方法)：

ref：
https://wiki.archlinux.org/index.php/GRUB/Tips_and_tricks_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)
https://wiki.archlinux.org/index.php/Unified_Extensible_Firmware_Interface_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#efibootmgr


echo 'configfile ${cmdpath}/grub.cfg' > /tmp/grub.cfg
sudo grub-mkstandalone -O x86_64-efi -o grubx64_standalone.efi "boot/grub/grub.cfg=/tmp/grub.cfg"

sudo efibootmgr --create --disk /dev/sda --part 2 --loader /mnt/sda2/EFI/uefi-hd/grubx64_standalone.efi --label "grubx64_standalone"


独立的 GRUB EFI 文件和这个 grub.cfg 可以存放在 EFI 系统分区中的任何一个目录里，只有它们处在同一个目录中就可以。这样它们就变得可移植了。 

然后，将 grubx64_standalone.efi 和 下面的 grub.cfg 放到一个目录即可：


werner@kubuntu:~$ cat /mnt/sda2/EFI/uefi-hd/grub.cfg 
search.fs_uuid f2ce6fb0-6dee-4979-b792-9df0bd728eed root hd0,gpt3 
set prefix=($root)'/grubconfig.git/boot/grub'
configfile $prefix/grub.cfg
werner@kubuntu:~$ 

























